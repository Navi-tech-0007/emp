{% extends "main.html" %}
{% block navbar %}{% endblock %}
{% block body %}
{% include "dashboard_nav.html" %}
{% set months = [] %}
<style>
  body {
    background: #f8f9fa;
  }
  .leave-card {
    border-radius: 1rem;
    box-shadow: 0 2px 12px rgba(0,0,0,0.06);
    border: 1px solid #e9ecef;
    background: #fff;
    margin-bottom: 2rem;
  }
  .leave-card-header {
    background: #f7f7f9;
    color: #222;
    border-top-left-radius: 1rem;
    border-top-right-radius: 1rem;
    font-weight: 600;
    font-size: 1.1rem;
    letter-spacing: .5px;
    padding: 1rem 1.5rem;
    border-bottom: 1px solid #e9ecef;
  }
  .leave-balance-table td {
    font-size: 1.05rem;
    padding: .5rem 1rem;
  }
  .leave-form label {
    font-weight: 500;
  }
  .leave-form .form-control, .leave-form select {
    border-radius: .5rem;
    background: #f8f9fa;
    border: 1px solid #e9ecef;
  }
  .leave-form .btn {
    border-radius: 2rem;
    font-weight: 600;
    letter-spacing: .5px;
    background: #e3f2fd;
    color: #1976d2;
    border: none;
    transition: background .2s, color .2s;
  }
  .leave-form .btn:hover {
    background: #bbdefb;
    color: #0d47a1;
  }
  .leave-history-table th, .leave-history-table td {
    vertical-align: middle !important;
    font-size: 1rem;
    background: #fff;
  }
  /* Modern, light badges */
  .badge-success {
    background: #e8f5e9;
    color: #388e3c;
    border: 1px solid #c8e6c9;
  }
  .badge-danger {
    background: #ffebee;
    color: #c62828;
    border: 1px solid #ffcdd2;
  }
  .badge-warning {
    background: #fff8e1;
    color: #f9a825;
    border: 1px solid #ffe082;
  }
  .badge-secondary {
    background: #eceff1;
    color: #607d8b;
    border: 1px solid #cfd8dc;
  }
  .badge {
    font-size: .95rem;
    padding: .5em 1.1em;
    border-radius: 2rem;
    font-weight: 600;
    letter-spacing: .5px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.03);
  }
  .info-btn {
    background: #e3f2fd;
    border: none;
    color: #1976d2;
    border-radius: 2rem;
    font-weight: 600;
    letter-spacing: .5px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    transition: background .2s, color .2s;
  }
  .info-btn:hover {
    background: #bbdefb;
    color: #0d47a1;
  }
  .modal-content {
    background: #fff;
    border-radius: 1rem;
    border: 1px solid #e9ecef;
  }
  .modal-header {
    background: #f7f7f9;
    color: #222;
    border-top-left-radius: 1rem;
    border-top-right-radius: 1rem;
    border-bottom: none;
  }
  .modal-footer {
    border-bottom-left-radius: 1rem;
    border-bottom-right-radius: 1rem;
    border-top: none;
  }
  .modal-title {
    font-weight: 600;
    letter-spacing: .5px;
  }

  /* Modern Leave Policy Info Modal */
  #leaveInfoModal .modal-content {
    border-radius: 1.2rem;
    border: none;
    box-shadow: 0 8px 32px rgba(25, 118, 210, 0.10);
    background: #f7fafd;
    padding: 0;
  }
  #leaveInfoModal .modal-header {
    background: #1976d2;
    color: #fff;
    border-top-left-radius: 1.2rem;
    border-top-right-radius: 1.2rem;
    border-bottom: none;
    padding-bottom: 0.5rem;
  }
  #leaveInfoModal .modal-title {
    font-weight: 700;
    letter-spacing: .5px;
  }
  #leaveInfoModal .modal-body {
    color: #222;
    background: #f7fafd;
    font-size: 1.08rem;
    padding-top: 1.2rem;
  }
  #leaveInfoModal ul {
    padding-left: 1.2rem;
    margin-bottom: 1rem;
  }
  #leaveInfoModal li {
    margin-bottom: .7em;
  }
  #leaveInfoModal .modal-footer {
    border-top: none;
    background: #f7fafd;
    border-bottom-left-radius: 1.2rem;
    border-bottom-right-radius: 1.2rem;
    justify-content: space-between;
  }
  #leaveInfoModal .btn-policy {
    background: #1976d2;
    color: #fff;
    border-radius: 2rem;
    font-weight: 600;
    letter-spacing: .5px;
    border: none;
    transition: background .2s;
  }
  #leaveInfoModal .btn-policy:hover {
    background: #1256a0;
    color: #fff;
  }

  /* Modern More Info Modal */
  #moreInfoModal .modal-content {
    border-radius: 1rem;
    box-shadow: 0 8px 32px rgba(0,0,0,0.18);
    border: none;
    background: #fff;
    animation: popIn .25s cubic-bezier(.4,2,.6,1) both;
  }
  @keyframes popIn {
    0% { transform: scale(.95); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
  }
  #moreInfoModal .modal-header {
    border-top-left-radius: 1rem;
    border-top-right-radius: 1rem;
    border-bottom: none;
    padding-bottom: 0;
  }
  #moreInfoModal .modal-footer {
    border-bottom-left-radius: 1rem;
    border-bottom-right-radius: 1rem;
    border-top: none;
    padding-top: 0;
  }
  #moreInfoModal .modal-title {
    font-weight: 600;
    letter-spacing: .5px;
  }
  #moreInfoModal .close {
    font-size: 1.5rem;
    outline: none;
  }
</style>

<div class="container" style="max-width: 1200px;">
  <div class="row">
    <!-- Leave Balances Panel -->
    <div class="col-lg-4 mb-4">
      <div class="card leave-card">
        <div class="leave-card-header">
          <i class="fa fa-calendar"></i> My Leave Balances
        </div>
        <div class="card-body p-3">
          <table class="table table-borderless leave-balance-table mb-0">
            {% for b in balances %}
              {% if b.leave_type in requestable_types %}
                <tr>
                  <td>{{ b.leave_type }} Leave</td>
                  <td class="text-right font-weight-bold">{{ b.balance|round(2) }}</td>
                </tr>
              {% endif %}
            {% endfor %}
          </table>
        </div>
      </div>
      <button type="button" class="btn info-btn btn-block mb-3" data-toggle="modal" data-target="#leaveInfoModal">
        <i class="fa fa-question-circle"></i> Leave Request Policy
      </button>
    </div>
    <!-- Leave Request Form -->
    <div class="col-lg-8 mb-4">
      <div class="card leave-card">
        <div class="leave-card-header" style="background: var(--color-accent, #17a2b8);">
          <i class="fa fa-paper-plane"></i> Request New Leave
        </div>
        <div class="card-body">
          <form method="post" id="leaveForm" class="leave-form" action="{{ url_for('leave.leave') }}">
            <div class="form-row">
              <div class="form-group col-md-4">
                <label for="leave_type">Leave Type</label>
                <select name="leave_type" id="leave_type" class="form-control" required>
                  <option value="" disabled selected>Choose...</option>
                  {% for t in requestable_types %}
                  <option value="{{ t }}">{{ t }}</option>
                  {% endfor %}
                </select>
              </div>
              <div class="form-group col-md-4">
                <label for="start_date">Start Date</label>
                <input type="date" name="start_date" id="start_date" class="form-control" required>
              </div>
              <div class="form-group col-md-4">
                <label for="end_date">End Date</label>
                <input type="date" name="end_date" id="end_date" class="form-control" required>
              </div>
            </div>
            <div class="form-row align-items-end">
              <div class="form-group col-md-8">
                <label for="reason">Reason</label>
                <input type="text" name="reason" id="reason" class="form-control" placeholder="Optional">
              </div>
              <div class="form-group col-md-4 text-right">
                <button type="button" class="btn btn-success btn-block mt-4" data-toggle="modal" data-target="#confirmModal">
                  <i class="fa fa-paper-plane"></i> Request Leave
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Leave Requests Table -->
  <div class="card leave-card">
    <div class="leave-card-header" style="background: var(--color-primary, #007bff);">
      <i class="fa fa-history"></i> Leave History
    </div>
    <!-- Filter for Leave History -->
    <div class="card-body pb-0">
      <div class="row mb-2">
        <div class="col-md-4 col-12 mb-2 mb-md-0">
          <input type="text" id="historyFilter" class="form-control" placeholder="Filter by type, status, or date...">
        </div>
        <div class="col-md-3 col-12">
          <select id="monthFilter" class="form-control">
            <option value="">Filter by month...</option>
            {% for leave in leaves %}
              {% set month = leave.start_date.strftime('%Y-%m') %}
              {% if month not in months %}
                {% set _ = months.append(month) %}
              {% endif %}
            {% endfor %}
            {% for month in months %}
              <option value="{{ month }}">{{ month }}</option>
            {% endfor %}
          </select>
        </div>
      </div>
    </div>

    <div class="card-body p-0">
      {% if leaves %}
      <div class="table-responsive">
        <table class="table table-striped table-hover leave-history-table mb-0">
          <thead class="thead-light">
            <tr>
              <th>Type</th>
              <th>Start</th>
              <th>End</th>
              <th>Status</th>
              <th>Reason</th>
              <th>Requested</th>
              <th>Reviewed By</th>
              <th>Reviewed At</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="leave-history-tbody">
            {% for leave in leaves %}
              <tr class="history-row{% if loop.index > 10 %} extra-leave-row{% endif %}{% if loop.index > 5 %} mobile-extra-leave-row{% endif %}" {% if loop.index > 10 %}style="display:none;"{% elif loop.index > 5 %}style="display:none;"{% endif %}>
                <td>{{ leave.leave_type }}</td>
                <td>{{ leave.start_date }}</td>
                <td>{{ leave.end_date }}</td>
                <td>
                  {% if leave.status == 'Approved' %}
                    <span class="badge badge-success">{{ leave.status }}</span>
                  {% elif leave.status == 'Rejected' %}
                    <span class="badge badge-danger">{{ leave.status }}</span>
                  {% elif leave.status == 'Cancelled' %}
                    <span class="badge badge-warning">{{ leave.status }}</span>
                  {% else %}
                    <span class="badge badge-secondary">{{ leave.status }}</span>
                  {% endif %}
                </td>
                <td>{{ leave.reason or '-' }}</td>
                <td>{{ leave.requested_at or '-' }}</td>
                <td>{{ leave.reviewed_by or '-' }}</td>
                <td>{{ leave.reviewed_at or '-' }}</td>
                <td>
                  {% if leave.status in ['Pending', 'Approved'] %}
                    <button type="button"
                            class="btn btn-sm btn-warning cancel-leave-btn"
                            data-leave-id="{{ leave.id }}"
                            data-toggle="modal"
                            data-target="#cancelModal">
                      Cancel
                    </button>
                  {% else %}
                    —
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
            <tr id="noResultsRow" style="display:none;">
              <td colspan="9" class="text-center text-muted">No results found</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="text-center my-3">
        <button id="loadMoreBtn" class="btn btn-outline-primary px-4" style="border-radius:2rem;">Load More</button>
      </div>
      {% else %}
        <div class="p-3 text-muted">No leave requests.</div>
      {% endif %}
    </div>
  </div>
</div>

<!-- Confirmation Modal -->
<div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="confirmModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="confirmModalLabel">Confirm Leave Request</h5>
        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Are you sure you want to submit this leave request?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-success" id="confirmSubmitBtn">Yes, Submit</button>
      </div>
    </div>
  </div>
</div>

<!-- Cancel Confirmation Modal -->
<div class="modal fade" id="cancelModal" tabindex="-1" role="dialog" aria-labelledby="cancelModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <form method="post" id="cancelLeaveForm">
        <div class="modal-header bg-warning text-dark">
          <h5 class="modal-title" id="cancelModalLabel">Cancel Leave Request</h5>
          <button type="button" class="close text-dark" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          Are you sure you want to cancel this leave request?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
          <button type="submit" class="btn btn-warning" id="confirmCancelBtn">Yes, Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Flash Modal (modern, centered) -->
{% set flash_messages = get_flashed_messages(with_categories=true) %}
<style>
  #flashModal .modal-content {
    border-radius: 1rem;
    box-shadow: 0 8px 32px rgba(0,0,0,0.18);
    border: none;
    background: #fff;
    animation: popIn .25s cubic-bezier(.4,2,.6,1) both;
  }
  @keyframes popIn {
    0% { transform: scale(.95); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
  }
  #flashModal .modal-header {
    border-top-left-radius: 1rem;
    border-top-right-radius: 1rem;
    border-bottom: none;
    padding-bottom: 0;
  }
  #flashModal .modal-footer {
    border-bottom-left-radius: 1rem;
    border-bottom-right-radius: 1rem;
    border-top: none;
    padding-top: 0;
  }
  #flashModal .modal-title {
    font-weight: 600;
    letter-spacing: .5px;
  }
  #flashModal .close {
    font-size: 1.5rem;
    outline: none;
  }
</style>
<div class="modal fade" id="flashModal" tabindex="-1" role="dialog" aria-labelledby="flashModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      {% if flash_messages %}
        {% set first_category = flash_messages[0][0] %}
        <div class="modal-header 
          {% if first_category == 'success' %}bg-success text-white
          {% elif first_category == 'danger' %}bg-danger text-white
          {% else %}bg-info text-white{% endif %}">
          <h5 class="modal-title" id="flashModalLabel">
            {% if first_category == 'success' %}Success
            {% elif first_category == 'danger' %}Error
            {% else %}Notice{% endif %}
          </h5>
          <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        {% if first_category == 'success' %}
          <div class="modal-body">
            <div class="alert alert-success" style="background:#e8f5e9; color:#388e3c; border:none; font-size:1.1rem;">
              <i class="fa fa-check-circle"></i>
              <strong>Submission Successful!</strong> Your leave request has been submitted.
              <br>
              <span style="color:#222;">
                <b>What happens next?</b>
                <ul style="margin-bottom:0.2rem;">
                  <li>Your request will be reviewed by your manager or HR.</li>
                  <li>You will receive a notification once your request is approved or rejected.</li>
                  <li>You can track the status in the Leave History table below.</li>
                  <li>If urgent, contact HR directly at <a href="mailto:hr@company.com">hr@company.com</a>.</li>
                </ul>
              </span>
            </div>
          </div>
        {% else %}
          <div class="modal-body">
            <ul class="mb-0 pl-3" style="font-size:1.1rem;">
              {% for category, message in flash_messages %}
                <li class="mb-2">{{ message }}</li>
              {% endfor %}
            </ul>
          </div>
        {% endif %}
        <div class="modal-footer justify-content-center">
          <button type="button" class="btn btn-outline-secondary px-4" data-dismiss="modal">Close</button>
        </div>
      {% endif %}
    </div>
  </div>
</div>

<!-- Modern Leave Info & Policy Modal -->
<div class="modal fade" id="leaveInfoModal" tabindex="-1" role="dialog" aria-labelledby="leaveInfoModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="leaveInfoModalLabel">
          <i class="fa fa-info-circle mr-2"></i>Leave Info & Full Policy
        </h5>
        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" style="max-height:60vh; overflow-y:auto;">
        <h5>How Leave Requests Work</h5>
        <ul>
          <li>Check your leave balance before submitting a request.</li>
          <li>Requests must be made at least <b>5 days in advance</b>.</li>
          <li>All leave is subject to approval by your manager or HR.</li>
          <li>You can track the status of your requests in the Leave History table.</li>
          <li>For urgent or special cases, contact HR directly.</li>
        </ul>
        <div class="alert alert-info" style="background:#e3f2fd; color:#1976d2; border:none;">
          <i class="fa fa-lightbulb-o"></i>
          <strong>Tip:</strong> For any questions, contact HR.
        </div>
        <hr>
        <h5>Full Leave Policy</h5>
        <h6>1. Eligibility</h6>
        <p>All full-time employees are eligible for paid leave as per their contract. Part-time and contract employees may have different entitlements.</p>
        <h6>2. Types of Leave</h6>
        <ul>
          <li><b>Annual Leave:</b> For vacation or personal time off.</li>
          <li><b>Sick Leave:</b> For illness or medical appointments.</li>
          <li><b>Emergency Leave:</b> For urgent, unforeseen circumstances.</li>
        </ul>
        <h6>3. Application Process</h6>
        <ol>
          <li>Submit your leave request at least 5 days in advance.</li>
          <li>Provide a valid reason and select the correct leave type.</li>
          <li>Wait for approval from your manager or HR.</li>
        </ol>
        <h6>4. Approval & Rejection</h6>
        <p>All leave requests are subject to approval. You will be notified via email or dashboard once your request is reviewed.</p>
        <h6>5. Special Cases</h6>
        <p>For emergencies or exceptions, contact HR directly at <a href="mailto:hr@company.com">hr@company.com</a>.</p>
        <h6>6. Policy Updates</h6>
        <p>This policy may be updated. Please check this page regularly for changes.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- Modern More Info Modal -->
<div class="modal fade" id="moreInfoModal" tabindex="-1" role="dialog" aria-labelledby="moreInfoModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header" style="background: #1976d2; color: #fff;">
        <h5 class="modal-title" id="moreInfoModalLabel">
          <i class="fa fa-info-circle mr-2"></i>How Leave Requests Work
        </h5>
        <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body" style="background: #f7fafd;">
        <ul>
          <li>Check your leave balance before submitting a request.</li>
          <li>Requests must be made at least <b>5 days in advance</b>.</li>
          <li>All leave is subject to approval by your manager or HR.</li>
          <li>You can track the status of your requests in the Leave History table.</li>
          <li>For urgent or special cases, contact HR directly.</li>
        </ul>
        <div class="alert alert-info" style="background:#e3f2fd; color:#1976d2; border:none;">
          <i class="fa fa-lightbulb-o"></i>
          <strong>Tip:</strong> For full details, see our leave policy.
        </div>
      </div>
      <div class="modal-footer justify-content-between" style="background: #f7fafd;">
        <a href="/static/policy.pdf" class="btn btn-policy" target="_blank">
          <i class="fa fa-external-link"></i> View Full Leave Policy
        </a>
        <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!-- jQuery and Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

{% if flash_messages %}
<script>
  $(function() {
    $('#flashModal').modal('show');
  });
</script>
{% endif %}

<script>
  // Modal confirmation for leave request
  document.getElementById('confirmSubmitBtn').onclick = function() {
    document.querySelector('#confirmModal .modal-body').innerHTML = '<span class="text-success">Submitting your request...</span>';
    document.getElementById('confirmSubmitBtn').disabled = true;
    setTimeout(function() {
      document.getElementById('leaveForm').submit();
    }, 700);
  };

  // Handle cancel button click
  document.querySelectorAll('.cancel-leave-btn').forEach(function(btn) {
    btn.addEventListener('click', function() {
      var leaveId = this.getAttribute('data-leave-id');
      var form = document.getElementById('cancelLeaveForm');
      form.action = "/cancel_leave/" + leaveId;
    });
  });

  // Load More functionality for leave history
  document.addEventListener('DOMContentLoaded', function() {
    var loadMoreBtn = document.getElementById('loadMoreBtn');
    if (loadMoreBtn) {
      loadMoreBtn.addEventListener('click', function() {
        document.querySelectorAll('.extra-leave-row').forEach(function(row) {
          row.style.display = '';
        });
        loadMoreBtn.style.display = 'none';
      });
    }
  });

  // Helper to get initial rows to show
  function getInitialRowsToShow() {
    return window.innerWidth < 768 ? 5 : 10;
  }

  // Filter and month filter logic
  function filterRows() {
    var filter = document.getElementById('historyFilter').value.toLowerCase();
    var month = document.getElementById('monthFilter').value;
    var rows = document.querySelectorAll('#leave-history-tbody tr');
    var visibleRows = 0;
    rows.forEach(function(row) {
      var text = row.textContent.toLowerCase();
      var show = true;
      if (filter && !text.includes(filter)) show = false;
      if (month) {
        var dateCell = row.children[1]; // Start date column
        if (dateCell) {
          var dateVal = dateCell.textContent.trim();
          show = show && dateVal.startsWith(month);
        }
      }
      row.style.display = show ? '' : 'none';
      if (show) visibleRows++;
    });
    // Hide Load More if filtering or if all visible
    var loadMoreBtn = document.getElementById('loadMoreBtn');
    if (filter || month) {
      loadMoreBtn.style.display = 'none';
    } else {
      var toShow = getInitialRowsToShow();
      var totalRows = rows.length;
      if (totalRows > toShow) {
        // Only show Load More if there are hidden rows
        var hiddenRows = Array.from(rows).slice(toShow).some(r => r.style.display !== 'none');
        loadMoreBtn.style.display = hiddenRows ? '' : 'none';
      } else {
        loadMoreBtn.style.display = 'none';
      }
    }

    // Show/hide no results row
    var noResultsRow = document.getElementById('noResultsRow');
    if (visibleRows === 0) {
      noResultsRow.style.display = '';
    } else {
      noResultsRow.style.display = 'none';
    }
  }

  document.getElementById('historyFilter').addEventListener('input', function() {
    var filter = this.value.toLowerCase();
    var rows = document.querySelectorAll('#leave-history-tbody tr:not(#noResultsRow)');
    var anyVisible = false;
    rows.forEach(function(row) {
      var text = row.textContent.toLowerCase();
      var show = text.includes(filter);
      row.style.display = show ? '' : 'none';
      if (show) anyVisible = true;
    });
    document.getElementById('noResultsRow').style.display = anyVisible ? 'none' : '';
  });

  document.getElementById('monthFilter').addEventListener('change', filterRows);

  // Responsive "Load More" for mobile/desktop
  function updateRowsDisplay() {
    var rows = document.querySelectorAll('#leave-history-tbody tr');
    var toShow = getInitialRowsToShow();
    rows.forEach(function(row, idx) {
      row.style.display = idx < toShow ? '' : 'none';
    });
    filterRows();
  }

  document.addEventListener('DOMContentLoaded', function() {
    updateRowsDisplay();
    document.getElementById('loadMoreBtn').addEventListener('click', function() {
      document.querySelectorAll('#leave-history-tbody tr').forEach(function(row) {
        row.style.display = '';
      });
      this.style.display = 'none';
    });
    window.addEventListener('resize', updateRowsDisplay);
  });
</script>
{% endblock %}
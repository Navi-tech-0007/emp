{% extends "base.html" %}

{% block extra_css %}
<style>
.directory-filters {
  display: flex;
  flex-wrap: wrap;
  gap: 1rem;
  margin-bottom: 2rem;
}
.directory-filters .form-select, .directory-filters .form-control {
  min-width: 180px;
  border-radius: 2rem;
  background: #f5f8fa;
  border: 1px solid #d1e3f8;
  box-shadow: none;
  transition: border-color 0.2s;
}
.directory-filters .form-select:focus, .directory-filters .form-control:focus {
  border-color: #2176c1;
  background: #fff;
}
.employee-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(270px, 1fr));
  gap: 1.5rem;
}
.employee-card {
  background: #fff;
  border-radius: 1.25rem;
  box-shadow: 0 2px 12px rgba(33,118,193,0.07);
  padding: 2rem 1.2rem 1.2rem 1.2rem;
  display: flex;
  flex-direction: column;
  align-items: center;
  transition: box-shadow 0.2s;
  border: 1px solid #e3ebfa;
}
.employee-card:hover {
  box-shadow: 0 4px 24px rgba(33,118,193,0.13);
  border-color: #2176c1;
}
.employee-photo {
  width: 72px;
  height: 72px;
  border-radius: 50%;
  object-fit: cover;
  margin-bottom: 1rem;
  border: 2px solid #e9ecef;
  background: #f5f8fa;
}
.employee-card .fa-user-circle {
  font-size: 4rem;
  color: #b0b8c1;
  margin-bottom: 1rem;
}
.employee-info {
  text-align: center;
  margin-bottom: 1rem;
}
.employee-info .name {
  font-size: 1.15rem;
  font-weight: 600;
  color: #2176c1;
}
.employee-info .username {
  color: #6c757d;
  font-size: 0.97rem;
}
.employee-meta {
  font-size: 0.97rem;
  color: #495057;
  margin-bottom: 0.25rem;
}
.employee-status {
  margin-bottom: 1rem;
}
.employee-actions {
  display: flex;
  gap: 0.5rem;
  width: 100%;
  justify-content: center;
}
@media (max-width: 600px) {
  .directory-filters {
    flex-direction: column;
    gap: 0.5rem;
  }
  .employee-grid {
    grid-template-columns: 1fr;
  }
}
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
  <h3 class="mb-4"><i class="fa fa-users text-primary"></i> Company Directory</h3>
  <form id="directoryFilters" class="directory-filters">
    <select id="roleFilter" class="form-select" aria-label="Filter by role">
      <option value="">All Roles</option>
      <option value="admin">Admin</option>
      <option value="hr">HR</option>
      <option value="root">Root</option>
      <option value="user">User</option>
    </select>
    <select id="deptFilter" class="form-select" aria-label="Filter by department">
      <option value="">All Departments</option>
      {% for dept in departments %}
        <option value="{{ dept }}">{{ dept }}</option>
      {% endfor %}
    </select>
    <input type="text" id="empSearch" class="form-control" placeholder="Search by name or email...">
  </form>

  <div class="employee-grid" id="employeeGrid">
    {% for emp in employees %}
    <div class="employee-card" data-role="{{ emp.role|lower }}" data-department="{{ emp.department|lower }}" data-name="{{ emp.name|lower }}" data-email="{{ emp.email|lower }}">
      {% if emp.photo_url %}
        <img src="{{ emp.photo_url }}" alt="Photo" class="employee-photo">
      {% else %}
        <span class="fa fa-user-circle"></span>
      {% endif %}
      <div class="employee-info">
        <div class="name">{{ emp.name }}</div>
        <div class="username">{{ emp.email or emp.username }}</div>
      </div>
      <div class="employee-meta"><strong>Role:</strong> {{ emp.role|capitalize }}</div>
      <div class="employee-meta"><strong>Department:</strong> {{ emp.department or '-' }}</div>
      <div class="employee-status">
        {% if emp.active %}
          <span class="badge bg-success">Active</span>
        {% else %}
          <span class="badge bg-secondary">Inactive</span>
        {% endif %}
      </div>
      <div class="employee-actions">
        <a href="{{ url_for('main.profile', username=emp.username) }}" class="btn btn-outline-primary btn-sm" title="View Profile">
          <i class="fa fa-eye"></i>
        </a>
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function filterDirectory() {
  const role = document.getElementById('roleFilter').value.toLowerCase();
  const dept = document.getElementById('deptFilter').value.toLowerCase();
  const search = document.getElementById('empSearch').value.toLowerCase();
  document.querySelectorAll('.employee-card').forEach(card => {
    const cardRole = card.dataset.role || '';
    const cardDept = card.dataset.department || '';
    const cardName = card.dataset.name || '';
    const cardEmail = card.dataset.email || '';
    let show = true;
    if (role && cardRole !== role) show = false;
    if (dept && cardDept !== dept) show = false;
    if (search && !(cardName.includes(search) || cardEmail.includes(search))) show = false;
    card.style.display = show ? '' : 'none';
  });
}
document.getElementById('roleFilter').addEventListener('change', filterDirectory);
document.getElementById('deptFilter').addEventListener('change', filterDirectory);
document.getElementById('empSearch').addEventListener('input', filterDirectory);
</script>
{% endblock %}